---
sidebar_position: 5
title: Motor Control
sidebar_label: Motor Control
---

Electric motors are the most controlled way to move a vehicle.
There are controls systems for internal combustion vehicles, but the have a longer feedback loop for controls systems than any of the electric motor options.

There are three main types of electric motors that are used in robotics:

- _Brushed DC_
- _Brushless DC_ (BLDC, EC, Electrically Commutated)
- _Induction_ (AC Induction, Asynchronous, Squirrel-cage)

Regardless of the type of electric motor, the principle of how they operate with ROS is similar.
A User or program publishes a velocity command to _cmd_vel_.
Motor controllers operate using:

- An input; of subscribing to the _cmd_vel_ ROS topic.
  This may be completed with an intermediary program that republishes the requested velocity to a syntax that the motor controller requires.
  This is common with larger off-the-shelf motor controllers that are not using ROS.
- An input; of the motor's current rotational speed.
  This is usually accomplished with an encoder, but there are other methods of getting the motor's rotational speed.
  :::note
  This differs from other motor control applications that are trying to achieve a motor position.
  Consider a laser-printer or a pick-and-place machine.
  These applications needs the tool at a specific position, and is less concerned about the velocity of the tool.
  :::
- An output; of controlling the motor.
  This will differ based on the type and size of motor, as some form controlling current using MOSFETs.
  The motor controller will take the inputs and use a [PID controller](https://en.wikipedia.org/wiki/PID_controller#Industrial_control) to effect these MOSFETs.

## Brushed DC

A Brushed DC motor has copper windings secured to the motor's rotating shaft.
The windings are surrounded by permenant magnets that are fixed to the motor housing.
These motors have two power leads.
When you apply a voltage across these power leads, current flows through the windings, which generates a magnetic field.
The magnetic field exerts a force on the housings magnets, causeing a torque on the shaft.

The winding's magnetic field is constantly flipping polarity, so the magnets always experience a force.
This changing magnetic field is due to mechanical commutation, where the electrical current runs through switches on the motor shaft.
These switches change where the voltage differential is in the motor, causing the magnetic field to rotate.
These switches are made of copper pads with graphite brushes, hence the name of the motor.

The main benefit of Brushed DC motors is the simplicity of the control system.
The motor controller can increase the exerted torque by increasing the current flowing to the motor.
This typically means the motor controller is changing the voltage difference across the motor windings, treating the motor as a resistor with Ohm's Law:

$$
I = \frac{v}{R}
$$

:::info

- I, electrical current in Amps (A)
- V, voltage potential across the windings in Volts (v)
- R, resistance of the electrical path in Ohms (Ω)

:::

The electric current will then create a magnetic field per Ampère's Force Law, noting that this is a simplified form:

$$
F = ILBsinθ
$$

:::info

- F, force in Newtons (N).
- I, electrical current in Amperes (A).
- L, length of the wire, in Metres (m).
- B, magnetic flux in Teslas, or the SI unit Newtons per Ampere (N/A).
  This is related to the size and location of the permenant magnet on the motor's shaft.
- θ, angle of the magnetic field relative to the wire's length, in degrees (°).

:::

For a Brushed DC motor, the controller can only affect the electrical current.
The other terms are intrinsic to the motor, with the exception of the angle _θ_.
Other types of motors allow the controller to change this angle by changing which sections of the windings are powered, but a Brushed DC motor changes the field location using it's mechanical commutator.

## Brushless DC {#motor_control_bldc}

Brushless DC motors (BLDC) have permanent magnets fastened to the rotating shaft.
The magnets are surrounded by copper windings that are fastened to the fixed motor housing.
Similar to a Brushed DC motor, the copper windings create a magnetic field which exerts a force on the permanent magnets.
The main difference is that the rotating magnetic field is created using MOSFETs, rather than through mechanical commutation.
This makes the motor simpler, as there are no graphite brushes that wear down.

:::note
There are no places for electrictity to arc inside a BLDC motor, since there are not brushes.
This makes BLDC motors an ideal choice for applications around combustable materials.

BLDC motors can also be submerged in water if they have a insulating potting compound around the elecrical components.
The magnetic field generated by the windings is not affected be the electical insulating compund.
The mechanical bearings of submerged motors are often magnetic or water pressure based, so corrosion does not seize these rotating joints.
:::

The controllers are more complex, since they need to perform high frequency switching of electric current so the winding's magnetic fields match the motors rotating speed.
These motors typically include an encoder to measure rotational speed.

:::note

BLDC motors rotational speed can be measured using back-EMF, where the controls circuitry measures the electric current in the windings being generated due to the motor shaft's rotating permanent magnets.
This is not usually implemented on small mobile robots since it is less acurate than an encoder at low rotational speeds.
Back-EMF measurements could be considered for lower cost applications, to remove the material cost of an encoder.

:::

## Induction

Induction motors are common in fixed industrial applications that have 3-phase AC electrical service.
These are used in mobile robots, since the motor controller converts battery DC voltage to 3 phase through MOSFETs, nearly identical to a BLDC motor.
The difference is, an Induction motor does not have any permenant magnets.
It still has fixed windings on the motor housing that create a magnetic field through electric commutation.
Similar to a BLDC motor, the motor shaft experiences a torgue due to the windings rotating magnetic field.
But the shaft's magnetic field is created by another set of windings fastened to the shaft, rather than the permenant magnets of a BLDC motor.
The shaft's windings get magnetized through induction, from the static housing's windings.
This causes the shaft's magnetic field to have a slight asyncronous delay to the housing's rotating magnetic field.
This is why these motors are called Induction or Asyncronous.

:::info

The term _AC induction_ is mainly due to these motors being developed in the 1800s when there was no way to control the electric current with a DC source.
On a mobile robot, the electric current is controlled using MOSFETs, though the effect is similar to the 3-phase AC electric source of the 1800s.

The AC motors directly connected to the electic grid would rotate at the frequency of the source AC sine waves.
On a mobile robot, this waveform is controlled by the MOSFETs, so the motor is variable speed.

:::

Similar to BLDC, Induction motor speed can be found using encoders or back-EMF.
